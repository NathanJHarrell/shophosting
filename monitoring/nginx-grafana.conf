# Grafana reverse proxy configuration
# Copy this to /etc/nginx/sites-available/ and adjust as needed

# Option 1: Subdomain (recommended)
# server {
#     listen 443 ssl http2;
#     server_name grafana.shophosting.io;
#
#     ssl_certificate /etc/letsencrypt/live/shophosting.io/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/shophosting.io/privkey.pem;
#
#     location / {
#         proxy_pass http://127.0.0.1:3000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }

# Option 2: Path-based (add to existing server block)
# Add this location block to your main shophosting.io server config:

location /grafana/ {
    proxy_pass http://127.0.0.1:3000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket support for live updates
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    # Rewrite for subpath
    rewrite ^/grafana/(.*) /$1 break;
}

# Prometheus (optional - only expose internally or with auth)
location /prometheus/ {
    # Restrict to admin IPs only
    # allow 10.0.0.0/8;
    # deny all;

    proxy_pass http://127.0.0.1:9090/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
